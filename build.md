# Построение

Программа предназначена для работы под Linux

## 0. Установить .NET 7.0

### 0.1. Вариант без установки .NET 7.0
Для сборки, в которую уже включён dotnet установка dotnet не требуется. Однако, требуются ручные операции.

Перейдите на страницу https://github.com/VinKekFish/VinKekFish/releases и выберите самый новый релиз. Кликните на "Assets" для развёртывания этого пункта и скачайте файлы vkf-dotnet7.7z и build.manual.zip .

Распакуйте vkf-dotnet7.7z и архив build.manual.7z. Замените файл vkf (в директории vkf-dotnet7) на файл vkf из архива build.manual.7z . После этого перейдите к пункту "4. Установка программы".


### 0.2. Вариант без установки .NET 7.0

Для Ubuntu Linux и Linux Mint необходимо выполнить в командной строке команду
```
sudo apt install -y dotnet7
```
для иных ОС необходимо смотреть
https://dotnet.microsoft.com/download

При возникновении проблем с libfuse программа будет, скорее всего, не работоспособна. Если нужно, попробуйте отключить её (дисковое шифрование и символьное устройство '/dev/vkf/crandom' перестанут работать):
```
    Попробуйте закомментировать символом "#" строку `character device in /dev` и строку под ней в файле настроек.
    Файл настроек располагается в `./Crypto/VinKekFish/src/main/5 main-crypto/exe/service/options_files/service.options`.
    После этого нужно сребилдить проект заново и запустить скрипт установки.
    или просто вручную заменить файл настроек в `/opt/VinKekFish/options/` и, без ребилда, перезапустить сервис vkf [`sudo systemctl restart vkf`].
```

Если вы хотите сами сбилдить проект, то перейдите к следующему пункту (пукнт 1).

Если вы хотите установить бинарный файл (это проще), то:
* Перейдите на страницу https://github.com/VinKekFish/VinKekFish/releases и выберите самый новый релиз.
* Кликните на "Assets" для развёртывания этого пункта и скачайте файл vkf-dotnet7.7z .
* Распакуйте vkf-dotnet7.7z в любую папку, из которой возможен запуск.
* Перейдите к пункту "4. Установка программы".


## 1. Извлечь вспомогательный репозиторий
```
mkdir Директория_где_вы_хотите_поместить_проекты
cd Директория_где_вы_хотите_поместить_проекты

mkdir -p ./Compiler
cd Compiler
git clone https://github.com/VinCryptoOS/tree-lang-main

cd ..

mkdir -p ./Crypto
cd Crypto
git clone https://github.com/VinKekFish/VinKekFish
```

## 2. Вызвать один из сценариев билда
Перейти в директорию VinKekFish
cd VinKekFish


Полностью перестроить решение
bash ./b/rebuild.sh

Или быстро перестроить решение (если решение было построено)
bash ./b/fbuild.sh

В случае успешного перестроения последняя строчка консоли будет начинаться с
"Builder successfully ended"
При построении тесты запускаются автоматически. При успешном билде, обычно, не должно быть проблем с сообщениями о том, что тесты прошли плохо. Однако, успешный билд иногда может пройти с плохими тестами на производительность (читайте сообщения тестов).


## 3. Исполняемые файлы проекта
Исполняемые файлы проекта билдятся в директорию ./Crypto/VinKekFish/build
(после выполнения пункта 2 мы уже находимся в ./Crypto/VinKekFish и оттуда запускаем билд)

## 4. Установка программы

Скрипт установки ./Crypto/VinKekFish/build/arcs/dotnet7/exe/install.sh
В файле скрипта необходимо поменять второй параметр командной строки на путь к файлу vkf-dotnet7.7z . После билда архивный файл расположен в папке ./Crypto/VinKekFish/build/arcs/ .
Если установлен флаг BuildDotnetIndependenceVersionFlag, то билд также будет собран в ./Crypto/VinKekFish/build.run/ (независимая от .NET версия).

После этого скрипт install.sh нужно запустить из-под пользователя root. Установка происходит в папку /opt/VinKekFish, в директорию /usr/local/bin копируется ссылка /usr/local/bin/vkf (эта директория, вероятно, в path и программу можно будет вызывать без указания пути). Скрипт зарегистрирует службу vkf.service, которая будет дополнительно собирать энтропию.


# Изменение состава проектов

В проекте нет решения, строительство осуществляется программой с исходниками [src/builder/builder/](src/builder/builder/)
и вызовом dotnet на каждый проект в отдельности

При появлении нового проекта
1. Внести его билд в файл [src/builder/builder/Build-projects.cs](src/builder/builder/Build-projects.cs)
2. Внести очистку директории bin этого проекта в [b/rebuild.sh](b/rebuild.sh) (и, если нужно, dotnet clean)
