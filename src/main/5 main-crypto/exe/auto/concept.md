# Описание концепции работы программы при шифровании
## Зашифрование незашифрованным ключевым файлом
Такое зашифрование идёт ключами, получаемыми из незашифрованного ключевого файла. Если злоумышленник получит доступ к такому файлу, то он сможет расшифровать всё, что зашифровано на этом ключе.

Примерные стадии шифрования:
- Инициализация случайными данными из /dev/vkf/random и из /dev/random
- Инициализация случайными данными из внешних файлов (если указано пользователем)
- Инициализация ключами, указанными пользователем. Порядок ключей важен и должен быть запомнен (или записан) пользователем
- Пароль не вводится. Если файл необходимо защитить паролем, то он должен быть зашифрован через первичный ключевой файл (для генерации первичного ключевого файла необходимо использовать команду [key-main](key-main.md)).
- Пользователь должен выбрать и запомнить (можно записать) режим шифрования и его настройки.
- После этого происходит шифрование файла в зависимости от выбранного режима и его настроек.

## Зашифрование первичным ключевым файлом
Зашифрование первичным ключевым файлом предполагает, что шифрующие губки инициализируются ключами, взятыми из иных зашифрованных ключевых файлов (первичного ключевого файла или вторичных ключевых файлов, которые созданы пользователем заранее). То есть, ключи в ключевых файлах защищены шифрованием и перед зашифрованием пользовательской информации эти ключи надо расшифровать.

Отличие от зашифрования незашифрованным ключом в том, что для того, чтобы расшифровать зашифрованные этими ключами пользовательские файлы, злоумышленнику придётся не только иметь ключевые файлы, но и подбирать пароль к первичному ключевому файлу (или получать его обманом, угадыванием, пытками или другим принуждением, подглядыванием, кейлоггерами или перехватом электромагнитных излучений).

- Первичный ключевой файл защищается паролем и, возможно, отделёнными от файла нешифрованными синхропосылками. Может быть вариант, когда первичный ключевой файл защищается только нешифрованной синхропосылкой (которая играет роль ключа).
- Первичный ключевой файл содержит ключ для шифрования вторичных ключевых файлов.
- Первичный файл может шифровать только вторичные ключевые файлы.
- Первичный ключевой файл содержит описатель режима шифрования и настройки шифрования для расшифрования самого себя внутри самого себя в незашифрованном виде, так что пользователю нужно помнить только пароль от первичного файла.
- Первичный ключевой файл содержит зашифрованный описатель режима шифрования и настройки шифрования для расшифрования вторичных ключевых файлов.
- Вторичный ключевой файл содержит зашифрованный описатель режима шифрования и настройки шифрования для расшифрования иных файлов.
- Каждый ключевой файл (как вторичный, так и первичный) может шифровать вторичные ключевые файлы . Если нужно шифровать в разных режимах, готовятся разные вторичные файлы.
- Вторичные ключевые файлы могут шифровать пользовательскую информацию или другие вторичные ключевые файлы.


