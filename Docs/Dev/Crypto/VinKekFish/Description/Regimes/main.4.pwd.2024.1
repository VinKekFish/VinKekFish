НЕ РЕАЛИЗОВАНО

Главный режим работы для шифрования первичного ключа
(src/main/5 main-crypto/exe/auto/enc/DoCryptStream.cs)

1. Генерация шума на три (два, если есть канал со скрытыми данными) канала. Шумы генерируются суммой губок: один поток - два ключа (на каждую губку). Первый канал выравнивается по длине (если скрытые данные меньше, чем первый канал, то в шифровании отказывается), остальные каналы имеют длину, равную первому каналу. Размер данных помещается отдельно внутри зашифрованного (потом) канала. Размер выравненных каналов помещается в незашифрованном виде перед всеми каналами. В случае шифрования шума, размер шума в каналах не ставится (просто сразу идёт шум, т.к. он по размеру совпадает с выравненным размером первого канала).

2. Каждый канал (включая шумы) шифруется своим ключом следующим образом.
    2.1. Гаммирование с обратной связью с помощью VinKekFish с хешированием. Размер хеша: 16*K кибибайтов. Таблицы VinKekFish перемешиваются с помощью специальной каскадной губки (с отдельным ключом).
    2.2. Перемешивание с помощью каскадной губки.
    2.3. Гаммирование с обратной связью каскадом с подписыванием хешем с этим же ключом (дуплекс с хешем в один проход). Для каскадной губки размер хеша равен её удвоенной номинальной стойкости (2*64*tall байтов).
    2.4. Обращение порядка байтов (так что хеш идёт первым и с инвертированным порядком байтов). Гаммирование арифметической суммой губок (каскадная и VinKekFish). Таблицы VinKekFish перемешиваются с помощью этой же каскадной губки. Гаммирование хеша 2.3 не делается. Вместо этого, этот хеш подаётся (в инвертированном порядке байтов) как синхропосылка в данную сумму губок.
    2.5. Гаммирование с обратной связью губкой VinKekFish без хеширования. Таблицы VinKekFish перемешиваются с помощью специальной каскадной губки; используется та же губка, что и в пункте 2.1 (с тем же ключом).

3. Всего четыре канала: основные данные, шум или резервные данные, шум по двум остальным каналам. Каналы не смешиваются, байты каналов просто идут друг за другом. Затем выполняется перестановка байтов с помощью каскадной губки на всём объединении этих каналов, чтобы достигнуть их случайного смешения.
4. Гаммирование с обратной связью с помощью каскадной губки без хеша.
5. Гаммирование с помощью суммы губок без хеша. Эта же гамма используется для выравнивания (то есть продолжение гаммы после открытого текста так, как если бы в открытом тексте продолжались бы нули). Выравнивание производится на границу файла, кратную 64 кибибайта с учётом последующей вставки хеша и наличия других служебных полей.
6. Инвертирование порядка байтов. Гаммирование с обратной связью с хешированием с помощью VinKekFish. Хеш в конце размером 8 кибибайтов * K.


----------------------------------------------------------------
----------------------------------------------------------------
----------------------------------------------------------------

Количество ключей шифрования.
1. Для генерации шума: 4 канала по два ключа. 8 ключей.
2.1. 4 канала по 1 ключу. 4 ключа. +1 ключ на перемешивание VinKekFish на каждыйканал: 4 ключа.
2.2. 4 канала по 1 ключу. 4 ключа.
2.3. 4 канала по 1 ключу. 4 ключа.
2.4. 4 канала по 2 ключа. 8 ключей.
2.5. 4 канала по 1 ключу. 4 ключа.
2. Всего для пункта 2: 4+4+4+4+8+4=28; пункты 1+2: 36 (9 ключей на канал)
3. 1 ключ.
4. 1 ключ.
5. 2 ключа.
6. 1 ключ.

Всего: 8+28+1+1+2+1=41 ключ.



